<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>


	<style>
	th, td {
		padding: 5px;
	}
	
	.performers {
  	float: right;
  	width: 70%;
	}
	/* table tr td:last-child {
		border: none;
	} */
	
	
</style>

  <script>
    $(function() {
      
      var result = [];
      $.getJSON('/data/festivals', function(data){
        $.each(data, function(i, f) {
        	var id= f.id;
        	var formatted = $.datepicker.formatDate("yy-mm-dd", new Date(f.date));
          var tblRow = "<tr>" + "<td>" +"<a href=/festivals/" + id + ">" +  f.name +"</a>" +  "</td>" 
          + "<td>" + f.place + "</td>" + "<td>" + formatted + "</td>" 
          + "<td>" + (f.seating - f.participants.length) + "/" + f.seating + "</td>" + "</tr>"
          
          $(tblRow).appendTo("#resultdata tbody");
        });
      });
    });
    
  </script>
  
  
  <script type="text/javascript">
      $(function() {
    	   
      	$.getJSON('/data/festivals', function(data){
      		$.each(data,function(index, item) {
      			var litem = "<li>" + item.name + "</li>"
      	
         	 	$(litem).appendTo("#menu");
      		});
      	
      	});
      
      });
  </script>
  
  <!-- Finds permitted actions for user and hide or show button -->
  
  <script type="text/javascript">
     
      function findAction() {
    	  var neededRole = "Deafult_ROLE";
        	$.getJSON('/data/rolesinfo', function(data){
        		$.each(data,function(index, item) {
        			if(item.actions.includes("change")) {
        				neededRole = item.role.role; 
        				console.log(neededRole);
        				showButton(neededRole);
        			}
        			    
        		});
        	
        	});
        
        }
      
      function showButton(role){
    	  document.getElementById('addfest').style.visibility = 'hidden';
    	  $.getJSON('/data/userroles', function(data){
    		  if (data != null) {
    		  	$.each(data,function(index, item) {
    	  			if(item.role == role) {
						document.getElementById('addfest').style.visibility = 'visible';
						console.log("show Button");
						return;
					}
    	  
    		  	});
    		 }
    		  
    		  else document.getElementById('addfest').style.visibility = 'hidden';
    		  
    	  });
      }
            
      findAction();
      
  </script>


</head>



<body>

	<th:block th:include="/_menu"></th:block>

	<h1>Festivals list</h1>

<article>
	<section>
      <table id="resultdata" border="1">
        <thead>
          <th>Name</th>
          <th>Place</th>
          <th>Date</th>
          <th>Seating</th>
        </thead>
        <tbody>

        </tbody>
        
      </table>
      </section>
      
      <section class="performers">
      
      		<ul id="menu">
      
      		</ul>
      
      	</section>
      
	</article>
      
      <br>
  
      <button onClick="javascript:window.location.href='/festivals/addfest'"  id="addfest" >Add festival</button>
      
   

      
</body>


</html>